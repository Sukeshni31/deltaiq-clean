<!DOCTYPE html>
<html>
<head>
  <title>DeltaAIQ</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #results div { cursor: pointer; padding: 5px; }
    #results div:hover { background: #eee; }
  </style>
</head>
<body>
  <h1>DeltaAIQ - AI Readiness Benchmark</h1>

  <input id="companyInput" placeholder="Start typing a company name" />
  <div id="results"></div>
  <select id="industrySelect">
    <option value="">Select Industry</option>
    <option>IT Services</option>
    <option>Aviation</option>
    <option>Manufacturing</option>
    <option>Pharma / Healthcare</option>
  </select>
  <button id="generateBtn">Generate AIQ</button>

  <h2>AIQ Result</h2>
  <div id="aiqOutput"></div>
  <canvas id="aiqChart" width="400" height="200"></canvas>

<script>
const input = document.getElementById("companyInput");
const results = document.getElementById("results");
const industrySelect = document.getElementById("industrySelect");
let timer;

input.addEventListener("input", () => {
  clearTimeout(timer);
  timer = setTimeout(async () => {
    const q = input.value.trim();
    if (!q) { results.innerHTML = ""; return; }
    const res = await fetch(`/api/companies?q=${encodeURIComponent(q)}`);
    const data = await res.json();
    results.innerHTML = data.map(c => `<div onclick="selectCompany('${c}')">${c}</div>`).join("");
  }, 300);
});

function selectCompany(name) {
  input.value = name;
  results.innerHTML = "";
}

document.getElementById("generateBtn").addEventListener("click", async () => {
  const company = input.value.trim();
  const industry = industrySelect.value;
  if (!company || !industry) { alert("Select company and industry"); return; }

  const res = await fetch("/api/aiq", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({ company, industry })
  });
  const data = await res.json();

  document.getElementById("aiqOutput").innerText = `
Company: ${company}
Industry: ${industry}
AIQ: ${data.aiq}
Industry Median: ${data.industryMedian}
Position: ${data.position}
  `;

  // Render chart
  const ctx = document.getElementById("aiqChart").getContext("2d");
  new Chart(ctx, {
    type: 'bar',
    data: {
      labels: ['AIQ', 'Industry Median'],
      datasets: [{
        label: 'Score',
        data: [data.aiq, data.industryMedian],
        backgroundColor: ['#4CAF50', '#2196F3']
      }]
    },
    options: {
      plugins: {
        legend: { display: false },
        tooltip: { enabled: true }
      },
      scales: {
        y: { min: 0, max: 100 }
      }
    }
  });
});
</script>
</body>
</html>
